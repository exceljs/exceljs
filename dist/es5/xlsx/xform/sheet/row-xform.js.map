{"version":3,"sources":["../../../../../lib/xlsx/xform/sheet/row-xform.js"],"names":["utils","require","BaseXform","CellXform","RowXform","module","exports","map","c","inherits","tag","prepare","model","options","styleId","styles","addStyleModel","style","cellXform","cells","forEach","cellModel","render","xmlStream","openNode","addAttribute","number","height","hidden","min","max","outlineLevel","collapsed","closeNode","parseOpen","node","parser","name","spans","attributes","split","span","parseInt","undefined","r","s","bestFit","ht","parseFloat","parseText","text","parseClose","push","reconcile","getStyleModel"],"mappings":"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","file":"row-xform.js","sourcesContent":["/**\n * Copyright (c) 2015 Guyon Roche\n * LICENCE: MIT - please refer to LICENCE file included with this module\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\n */\n\n'use strict';\n\nvar utils = require('../../../utils/utils');\nvar BaseXform = require('../base-xform');\n\nvar CellXform = require('./cell-xform');\n\nvar RowXform = module.exports = function() {\n  this.map = {\n    c: new CellXform()\n  };\n};\n\n// <row r=\"<%=row.number%>\"\n//     <% if(row.height) {%> ht=\"<%=row.height%>\" customHeight=\"1\"<% } %>\n//     <% if(row.hidden) {%> hidden=\"1\"<% } %>\n//     <% if(row.min > 0 && row.max > 0 && row.min <= row.max) {%> spans=\"<%=row.min%>:<%=row.max%>\"<% } %>\n//     <% if (row.styleId) { %> s=\"<%=row.styleId%>\" customFormat=\"1\" <% } %>\n//     x14ac:dyDescent=\"0.25\">\n//   <% row.cells.forEach(function(cell){ %>\n//     <%=cell.xml%><% }); %>\n// </row>\n\nutils.inherits(RowXform, BaseXform, {\n\n  get tag() { return 'row'; },\n\n  prepare: function(model, options) {\n    var styleId = options.styles.addStyleModel(model.style);\n    if (styleId) {\n      model.styleId = styleId;\n    }\n    var cellXform = this.map.c;\n    model.cells.forEach(function(cellModel) {\n      cellXform.prepare(cellModel, options);\n    });\n  },\n  \n  render: function(xmlStream, model, options) {\n    xmlStream.openNode('row');\n    xmlStream.addAttribute('r', model.number);\n    if (model.height) {\n      xmlStream.addAttribute('ht', model.height);\n      xmlStream.addAttribute('customHeight', '1');\n    }\n    if (model.hidden) {\n      xmlStream.addAttribute('hidden', '1');\n    }\n    if (model.min > 0 && model.max > 0 && model.min <= model.max) {\n      xmlStream.addAttribute('spans', model.min + ':' + model.max);\n    }\n    if (model.styleId) {\n      xmlStream.addAttribute('s', model.styleId);\n      xmlStream.addAttribute('customFormat', '1');\n    }\n    xmlStream.addAttribute('x14ac:dyDescent', '0.25');\n    if (model.outlineLevel) {\n      xmlStream.addAttribute('outlineLevel', model.outlineLevel);\n    }\n    if (model.collapsed) {\n      xmlStream.addAttribute('collapsed', '1');\n    }\n\n    var cellXform = this.map.c;\n    model.cells.forEach(function(cellModel) {\n      cellXform.render(xmlStream, cellModel, options);\n    });\n\n    xmlStream.closeNode();\n  },\n  \n  parseOpen: function(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    } else if (node.name === 'row') {\n      var spans = node.attributes.spans ? node.attributes.spans.split(':').map(function(span) { return parseInt(span, 10); }) : [undefined, undefined];\n      var model = this.model = {\n        number: parseInt(node.attributes.r, 10),\n        min: spans[0],\n        max: spans[1],\n        cells: []\n      };\n      if (node.attributes.s) {\n        model.styleId = parseInt(node.attributes.s, 10);\n      }\n      if (node.attributes.hidden) {\n        model.hidden = true;\n      }\n      if (node.attributes.bestFit) {\n        model.bestFit = true;\n      }\n      if (node.attributes.ht) {\n        model.height = parseFloat(node.attributes.ht);\n      }\n      if (node.attributes.outlineLevel) {\n        model.outlineLevel = parseInt(node.attributes.outlineLevel, 10);\n      }\n      if (node.attributes.collapsed) {\n        model.collapsed = true;\n      }\n      return true;\n    }\n\n    this.parser = this.map[node.name];\n    if ((this.parser)) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    return false;\n  },\n  parseText: function(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  },\n  parseClose: function(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.model.cells.push(this.parser.model);\n        this.parser = undefined;\n      }\n      return true;\n    }\n    return false;\n  },\n  \n  reconcile: function(model, options) {\n    model.style = model.styleId ? options.styles.getStyleModel(model.styleId) : {};\n    if (model.styleId !== undefined) {\n      model.styleId = undefined;\n    }\n\n    var cellXform = this.map.c;\n    model.cells.forEach(function(cellModel) {\n      cellXform.reconcile(cellModel, options);\n    });\n  }\n});\n"]}