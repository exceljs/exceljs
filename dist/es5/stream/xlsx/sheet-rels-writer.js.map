{"version":3,"sources":["../../../../lib/stream/xlsx/sheet-rels-writer.js"],"names":["utils","require","RelType","HyperlinksProxy","sheetRelsWriter","writer","prototype","push","hyperlink","addHyperlink","SheetRelsWriter","module","exports","options","id","count","_hyperlinks","_workbook","workbook","stream","_stream","_openStream","length","each","fn","forEach","hyperlinksProxy","_hyperlinksProxy","relationship","Target","target","Type","Hyperlink","TargetMode","rId","_writeRelationship","address","addMedia","media","commit","_writeClose","end","_writeOpen","write","xmlEncode"],"mappings":"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","file":"sheet-rels-writer.js","sourcesContent":["/**\n * Copyright (c) 2015-2017 Guyon Roche\n * LICENCE: MIT - please refer to LICENCE file included with this module\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\n */\n\n'use strict';\n\nvar utils = require('../../utils/utils');\nvar RelType = require('../../xlsx/rel-type');\n\nvar HyperlinksProxy = function(sheetRelsWriter) {\n  this.writer = sheetRelsWriter;\n};\nHyperlinksProxy.prototype = {\n  push: function(hyperlink) {\n    this.writer.addHyperlink(hyperlink);\n  }\n};\n\nvar SheetRelsWriter = module.exports = function(options) {\n  // in a workbook, each sheet will have a number\n  this.id = options.id;\n\n  // count of all relationships\n  this.count = 0;\n\n  // keep record of all hyperlinks\n  this._hyperlinks = [];\n\n  this._workbook = options.workbook;\n};\nSheetRelsWriter.prototype = {\n\n  get stream() {\n    if (!this._stream) {\n      // eslint-disable-next-line no-underscore-dangle\n      this._stream = this._workbook._openStream('/xl/worksheets/_rels/sheet' + this.id + '.xml.rels');\n    }\n    return this._stream;\n  },\n\n  get length() {\n    return this._hyperlinks.length;\n  },\n\n  each: function(fn) {\n    return this._hyperlinks.forEach(fn);\n  },\n\n  get hyperlinksProxy() {\n    return this._hyperlinksProxy ||\n      (this._hyperlinksProxy = new HyperlinksProxy(this));\n  },\n  addHyperlink: function(hyperlink) {\n    // Write to stream\n    var relationship = {\n      Target: hyperlink.target,\n      Type: RelType.Hyperlink,\n      TargetMode: 'External'\n    };\n    var rId = this._writeRelationship(relationship);\n\n    // store sheet stuff for later\n    this._hyperlinks.push({\n      rId: rId,\n      address: hyperlink.address\n    });\n  },\n\n  addMedia: function(media) {\n    return this._writeRelationship(media);\n  },\n\n  commit: function() {\n    if (this.count) {\n      // write xml utro\n      this._writeClose();\n      // and close stream\n      this.stream.end();\n    }\n  },\n\n  // ================================================================================\n  _writeOpen: function() {\n    this.stream.write(\n      '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>' +\n      '<Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">');\n  },\n  _writeRelationship: function(relationship) {\n    if (!this.count) {\n      this._writeOpen();\n    }\n\n    var rId = 'rId' + ++this.count;\n\n    if (relationship.TargetMode) {\n      this.stream.write(\n        '<Relationship' +\n        ' Id=\"' + rId + '\"' +\n        ' Type=\"' + relationship.Type + '\"' +\n        ' Target=\"' + utils.xmlEncode(relationship.Target) + '\"' +\n        ' TargetMode=\"' + relationship.TargetMode + '\"' +\n        '/>');\n    } else {\n      this.stream.write(\n        '<Relationship' +\n        ' Id=\"' + rId + '\"' +\n        ' Type=\"' + relationship.Type + '\"' +\n        ' Target=\"' + relationship.Target + '\"' +\n        '/>');\n    }\n\n\n    return rId;\n  },\n  _writeClose: function() {\n    this.stream.write('</Relationships>');\n  }\n};\n"]}