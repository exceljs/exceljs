{"version":3,"sources":["../../../../lib/stream/xlsx/hyperlink-reader.js"],"names":["events","require","Sax","utils","Enums","RelType","HyperlinkReader","module","exports","workbook","id","_workbook","inherits","EventEmitter","count","hyperlinks","length","each","fn","forEach","read","entry","options","self","emitHyperlinks","autodrain","emit","parser","createStream","on","node","name","rId","attributes","Id","Type","Hyperlink","relationship","type","RelationshipType","Styles","target","Target","targetMode","TargetMode","flowControl","createChild","pipe","sync"],"mappings":"AAAA;;;;;;AAMA;;AAEA,IAAIA,SAASC,QAAQ,QAAR,CAAb;AACA,IAAIC,MAAMD,QAAQ,KAAR,CAAV;;AAEA,IAAIE,QAAQF,QAAQ,mBAAR,CAAZ;AACA,IAAIG,QAAQH,QAAQ,iBAAR,CAAZ;AACA,IAAII,UAAUJ,QAAQ,qBAAR,CAAd;;AAEA,IAAIK,kBAAkBC,OAAOC,OAAP,GAAiB,UAASC,QAAT,EAAmBC,EAAnB,EAAuB;AAC5D;AACA,OAAKA,EAAL,GAAUA,EAAV;;AAEA,OAAKC,SAAL,GAAiBF,QAAjB;AACD,CALD;;AAOAN,MAAMS,QAAN,CAAeN,eAAf,EAAgCN,OAAOa,YAAvC,EAAqD;;AAEnD,MAAIC,KAAJ,GAAY;AACV,WAAQ,KAAKC,UAAL,IAAmB,KAAKA,UAAL,CAAgBC,MAApC,IAA+C,CAAtD;AACD,GAJkD;;AAMnDC,QAAM,cAASC,EAAT,EAAa;AACjB,WAAO,KAAKH,UAAL,CAAgBI,OAAhB,CAAwBD,EAAxB,CAAP;AACD,GARkD;;AAUnDE,QAAM,cAASC,KAAT,EAAgBC,OAAhB,EAAyB;AAC7B,QAAIC,OAAO,IAAX;AACA,QAAIC,iBAAiB,KAArB;AACA,QAAIT,aAAa,IAAjB;AACA,YAAQO,QAAQP,UAAhB;AACE,WAAK,MAAL;AACES,yBAAiB,IAAjB;AACA;AACF,WAAK,OAAL;AACE,aAAKT,UAAL,GAAkBA,aAAa,EAA/B;AACA;AACF;AACE;AARJ;AAUA,QAAI,CAACS,cAAD,IAAmB,CAACT,UAAxB,EAAoC;AAClCM,YAAMI,SAAN;AACAF,WAAKG,IAAL,CAAU,UAAV;AACA;AACD;;AAED,QAAIC,SAASzB,IAAI0B,YAAJ,CAAiB,IAAjB,EAAuB,EAAvB,CAAb;AACAD,WAAOE,EAAP,CAAU,SAAV,EAAqB,UAASC,IAAT,EAAe;AAClC,UAAIA,KAAKC,IAAL,KAAc,cAAlB,EAAkC;AAChC,YAAIC,MAAMF,KAAKG,UAAL,CAAgBC,EAA1B;AACA,gBAAQJ,KAAKG,UAAL,CAAgBE,IAAxB;AACE,eAAK9B,QAAQ+B,SAAb;AACE,gBAAIC,eAAe;AACjBC,oBAAMlC,MAAMmC,gBAAN,CAAuBC,MADZ;AAEjBR,mBAAKA,GAFY;AAGjBS,sBAAQX,KAAKG,UAAL,CAAgBS,MAHP;AAIjBC,0BAAYb,KAAKG,UAAL,CAAgBW;AAJX,aAAnB;AAMA,gBAAIpB,cAAJ,EAAoB;AAClBD,mBAAKG,IAAL,CAAU,WAAV,EAAuBW,YAAvB;AACD,aAFD,MAEO;AACLtB,yBAAWsB,aAAaL,GAAxB,IAA+BK,YAA/B;AACD;AACD;AACF;AACE;AAfJ;AAiBD;AACF,KArBD;AAsBAV,WAAOE,EAAP,CAAU,KAAV,EAAiB,YAAW;AAC1BN,WAAKG,IAAL,CAAU,UAAV;AACD,KAFD;;AAIA;AACA,QAAImB,cAAc,KAAKlC,SAAL,CAAekC,WAAf,CAA2BC,WAA3B,EAAlB;AACAD,gBAAYE,IAAZ,CAAiBpB,MAAjB,EAAyB,EAACqB,MAAM,IAAP,EAAzB;AACA3B,UAAM0B,IAAN,CAAWF,WAAX;AACD;AA7DkD,CAArD","file":"hyperlink-reader.js","sourcesContent":["/**\n * Copyright (c) 2015-2017 Guyon Roche\n * LICENCE: MIT - please refer to LICENCE file included with this module\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\n */\n\n'use strict';\n\nvar events = require('events');\nvar Sax = require('sax');\n\nvar utils = require('../../utils/utils');\nvar Enums = require('../../doc/enums');\nvar RelType = require('../../xlsx/rel-type');\n\nvar HyperlinkReader = module.exports = function(workbook, id) {\n  // in a workbook, each sheet will have a number\n  this.id = id;\n\n  this._workbook = workbook;\n};\n\nutils.inherits(HyperlinkReader, events.EventEmitter, {\n\n  get count() {\n    return (this.hyperlinks && this.hyperlinks.length) || 0;\n  },\n\n  each: function(fn) {\n    return this.hyperlinks.forEach(fn);\n  },\n\n  read: function(entry, options) {\n    var self = this;\n    var emitHyperlinks = false;\n    var hyperlinks = null;\n    switch (options.hyperlinks) {\n      case 'emit':\n        emitHyperlinks = true;\n        break;\n      case 'cache':\n        this.hyperlinks = hyperlinks = {};\n        break;\n      default:\n        break;\n    }\n    if (!emitHyperlinks && !hyperlinks) {\n      entry.autodrain();\n      self.emit('finished');\n      return;\n    }\n\n    var parser = Sax.createStream(true, {});\n    parser.on('opentag', function(node) {\n      if (node.name === 'Relationship') {\n        var rId = node.attributes.Id;\n        switch (node.attributes.Type) {\n          case RelType.Hyperlink:\n            var relationship = {\n              type: Enums.RelationshipType.Styles,\n              rId: rId,\n              target: node.attributes.Target,\n              targetMode: node.attributes.TargetMode\n            };\n            if (emitHyperlinks) {\n              self.emit('hyperlink', relationship);\n            } else {\n              hyperlinks[relationship.rId] = relationship;\n            }\n            break;\n          default:\n            break;\n        }\n      }\n    });\n    parser.on('end', function() {\n      self.emit('finished');\n    });\n\n    // create a down-stream flow-control to regulate the stream\n    var flowControl = this._workbook.flowControl.createChild();\n    flowControl.pipe(parser, {sync: true});\n    entry.pipe(flowControl);\n  }\n});\n"]}