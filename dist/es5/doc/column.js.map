{"version":3,"sources":["../../../lib/doc/column.js"],"names":["_","require","Enums","colCache","Column","module","exports","worksheet","number","defn","_worksheet","_number","prototype","letter","n2l","isCustomWidth","width","undefined","header","_header","key","style","hidden","outlineLevel","value","_hidden","headers","Array","forEach","text","index","getCell","_key","column","getColumnKey","deleteColumnKey","setColumnKey","_outlineLevel","collapsed","properties","outlineLevelCol","toString","JSON","stringify","length","equivalentTo","other","isEqual","isDefault","s","font","numFmt","alignment","border","fill","headerCount","eachCell","options","iteratee","colNumber","eachRow","row","rowNumber","values","v","cell","type","ValueType","Null","offset","hasOwnProperty","_applyStyle","name","toModel","columns","cols","col","min","max","push","fromModel","count"],"mappings":"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","file":"column.js","sourcesContent":["/**\n * Copyright (c) 2014-2017 Guyon Roche\n * LICENCE: MIT - please refer to LICENCE file included with this module\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\n */\n\n'use strict';\n\nvar _ = require('../utils/under-dash');\n\nvar Enums = require('./enums');\nvar colCache = require('../utils/col-cache');\n// Column defines the column properties for 1 column.\n// This includes header rows, widths, key, (style), etc.\n// Worksheet will condense the columns as appropriate during serialization\nvar Column = module.exports = function(worksheet, number, defn) {\n  this._worksheet = worksheet;\n  this._number = number;\n  if (defn !== false) {\n    // sometimes defn will follow\n    this.defn = defn;\n  }\n};\n\nColumn.prototype = {\n  get number() {\n    return this._number;\n  },\n  get worksheet() {\n    return this._worksheet;\n  },\n  get letter() {\n    return colCache.n2l(this._number);\n  },\n  get isCustomWidth() {\n    return (this.width !== undefined) && (this.width !== 8);\n  },\n  get defn() {\n    return {\n      header: this._header,\n      key: this.key,\n      width: this.width,\n      style: this.style,\n      hidden: this.hidden,\n      outlineLevel: this.outlineLevel\n    };\n  },\n  set defn(value) {\n    if (value) {\n      this.key = value.key;\n      this.width = value.width;\n      this.outlineLevel = value.outlineLevel;\n      if (value.style) {\n        this.style = value.style;\n      } else {\n        this.style = {};\n      }\n\n      // headers must be set after style\n      this.header = value.header;\n      this._hidden = !!value.hidden;\n    } else {\n      delete this._header;\n      delete this.key;\n      delete this.width;\n      this.style = {};\n      this.outlineLevel = 0;\n    }\n  },\n  get headers() {\n    return this._header && (this._header instanceof Array) ?\n      this._header :\n      [this._header];\n  },\n  get header() {\n    return this._header;\n  },\n  set header(value) {\n    if (value !== undefined) {\n      this._header = value;\n      this.headers.forEach((text, index) => {\n        this._worksheet.getCell(index + 1, this.number).value = text;\n      });\n    } else {\n      this._header = undefined;\n    }\n  },\n  get key() {\n    return this._key;\n  },\n  set key(value) {\n    const column = this._key && this._worksheet.getColumnKey(this._key);\n    if (column === this) {\n      this._worksheet.deleteColumnKey(this._key);\n    }\n\n    this._key = value;\n    if (value) {\n      this._worksheet.setColumnKey(this._key, this);\n    }\n  },\n  get hidden() {\n    return !!this._hidden;\n  },\n  set hidden(value) {\n    this._hidden = value;\n  },\n  get outlineLevel() {\n    return this._outlineLevel || 0;\n  },\n  set outlineLevel(value) {\n    this._outlineLevel = value;\n  },\n  get collapsed() {\n    return !!(this._outlineLevel && (this._outlineLevel >= this._worksheet.properties.outlineLevelCol));\n  },\n\n  toString: function() {\n    return JSON.stringify({\n      key: this.key,\n      width: this.width,\n      headers: this.headers.length ? this.headers : undefined\n    });\n  },\n  equivalentTo: function(other) {\n    return (this.width === other.width) &&\n            (this.hidden === other.hidden) &&\n            (this.outlineLevel === other.outlineLevel) &&\n            _.isEqual(this.style, other.style);\n  },\n  get isDefault() {\n    if (this.isCustomWidth) {\n      return false;\n    }\n    if (this.hidden) {\n      return false;\n    }\n    if (this.outlineLevel) {\n      return false;\n    }\n    var s = this.style;\n    if (s && (s.font || s.numFmt || s.alignment || s.border || s.fill)) {\n      return false;\n    }\n    return true;\n  },\n  get headerCount() {\n    return this.headers.length;\n  },\n\n  eachCell: function(options, iteratee) {\n    var colNumber = this.number;\n    if (!iteratee) {\n      iteratee = options;\n      options = null;\n    }\n    this._worksheet.eachRow(options, function(row, rowNumber) {\n      iteratee(row.getCell(colNumber), rowNumber);\n    });\n  },\n\n  get values() {\n    const v = [];\n    this.eachCell((cell, rowNumber) => {\n      if (cell && cell.type !== Enums.ValueType.Null) {\n        v[rowNumber] = cell.value;\n      }\n    });\n    return v;\n  },\n\n  set values(v) {\n    if (!v) {\n      return;\n    }\n    const colNumber = this.number;\n    let offset = 0;\n    if (v.hasOwnProperty('0')) {\n      // assume contiguous array, start at row 1\n      offset = 1;\n    }\n    v.forEach((value, index) => {\n      this._worksheet.getCell(index + offset, colNumber).value = value;\n    });\n  },\n\n  // =========================================================================\n  // styles\n  _applyStyle: function(name, value) {\n    this.style[name] = value;\n    this.eachCell(function(cell) {\n      cell[name] = value;\n    });\n    return value;\n  },\n\n  get numFmt() {\n    return this.style.numFmt;\n  },\n  set numFmt(value) {\n    this._applyStyle('numFmt', value);\n  },\n  get font() {\n    return this.style.font;\n  },\n  set font(value) {\n    this._applyStyle('font', value);\n  },\n  get alignment() {\n    return this.style.alignment;\n  },\n  set alignment(value) {\n    this._applyStyle('alignment', value);\n  },\n  get border() {\n    return this.style.border;\n  },\n  set border(value) {\n    this._applyStyle('border', value);\n  },\n  get fill() {\n    return this.style.fill;\n  },\n  set fill(value) {\n    this._applyStyle('fill', value);\n  }\n};\n\n// =============================================================================\n// static functions\n\nColumn.toModel = function(columns) {\n  // Convert array of Column into compressed list cols\n  var cols = [];\n  var col = null;\n  if (columns) {\n    columns.forEach(function(column, index) {\n      if (column.isDefault) {\n        if (col) {\n          col = null;\n        }\n      } else if (!col || !column.equivalentTo(col)) {\n        col = {\n          min: index + 1,\n          max: index + 1,\n          width: column.width,\n          style: column.style,\n          isCustomWidth: column.isCustomWidth,\n          hidden: column.hidden,\n          outlineLevel: column.outlineLevel,\n          collapsed: column.collapsed\n        };\n        cols.push(col);\n      } else {\n        col.max = index + 1;\n      }\n    });\n  }\n  return cols.length ? cols : undefined;\n};\n\nColumn.fromModel = function(worksheet, cols) {\n  cols = cols || [];\n  var columns = [];\n  var count = 1;\n  var index = 0;\n  while (index < cols.length) {\n    var col = cols[index++];\n    while (count < col.min) {\n      columns.push(new Column(worksheet, count++));\n    }\n    while (count <= col.max) {\n      columns.push(new Column(worksheet, count++, col));\n    }\n  }\n  return columns.length ? columns : null;\n};\n"]}